

üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

ISUP/ISAPI Bridge ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ–Ω–∞–¥–µ–∂–Ω—ã–π —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ Hikvision (—Ç—É—Ä–Ω–∏–∫–µ—Ç—ã, —Ç–µ—Ä–º–∏–Ω–∞–ª—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü–∞, –∫–∞—Ä—Ç–æ—á–Ω—ã–µ —Å—á–∏—Ç—ã–≤–∞—Ç–µ–ª–∏), –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∏—Ö –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ 1–° (–£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ / ERP / –£–†–í / –ó–£–ü).

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞:

üîµ ISUP v5 (–±–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª —Ç—É—Ä–Ω–∏–∫–µ—Ç–æ–≤)
	‚Ä¢	–ü—Ä—è–º–æ–µ TCP-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
	‚Ä¢	–ü–∞—Ä—Å–∏–Ω–≥ –±–∏–Ω–∞—Ä–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
	‚Ä¢	–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ACK
	‚Ä¢	–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ IN/OUT
	‚Ä¢	–ö–∞—Ä—Ç—ã, –ø–∏–Ω-–∫–æ–¥—ã, QR, –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

üîµ ISAPI (HTTP Webhook, EventNotificationAlert)
	‚Ä¢	–¢–µ—Ä–º–∏–Ω–∞–ª—ã FACE / CARD / MIXED
	‚Ä¢	–ü–æ–¥–¥–µ—Ä–∂–∫–∞ multipart (XML + JPEG snaphost)
	‚Ä¢	–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ cardNo, employeeNo, door, reader
	‚Ä¢	–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (IN/OUT)

‚∏ª

‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

/opt/isup_bridge/
‚îÇ‚îÄ‚îÄ main.py                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ‚îÄ‚îÄ core/
‚îÇ     ‚îú‚îÄ‚îÄ processor.py        # –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ 1–°
‚îÇ     ‚îú‚îÄ‚îÄ storage.py          # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ pending-—Å–æ–±—ã—Ç–∏–π
‚îÇ     ‚îú‚îÄ‚îÄ tenant_manager.py   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞–º–∏/1–°
‚îÇ     ‚îî‚îÄ‚îÄ metrics.py          # –ú–µ—Ç—Ä–∏–∫–∏
‚îÇ‚îÄ‚îÄ isup/
‚îÇ     ‚îú‚îÄ‚îÄ isup_protocol.py    # –ü–∞—Ä—Å–µ—Ä ISUP v5 + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ACK
‚îÇ     ‚îî‚îÄ‚îÄ isup_server.py      # ISUP TCP —Å–µ—Ä–≤–µ—Ä
‚îÇ‚îÄ‚îÄ isapi/
‚îÇ     ‚îú‚îÄ‚îÄ isapi_client.py     # ISAPI Event parser + —Ç–µ—Ä–º–∏–Ω–∞–ª—ã
‚îÇ     ‚îî‚îÄ‚îÄ isapi_server.py     # HTTP —Å–µ—Ä–≤–µ—Ä ISAPI Webhook
‚îÇ‚îÄ‚îÄ utils/
‚îÇ     ‚îî‚îÄ‚îÄ logging_setup.py    # –ï–¥–∏–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ‚îÄ‚îÄ config/
‚îÇ     ‚îî‚îÄ‚îÄ config.yaml         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤, —É—Å—Ç—Ä–æ–π—Å—Ç–≤, 1–°
‚îî‚îÄ‚îÄ requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞


‚∏ª

üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

üîí 1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ Hikvision —É—Å—Ç—Ä–æ–π—Å—Ç–≤
	‚Ä¢	–¢—É—Ä–Ω–∏–∫–µ—Ç—ã
	‚Ä¢	–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–æ ISUP
	‚Ä¢	–õ–∏—Ü–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã
	‚Ä¢	–≥–∏–±—Ä–∏–¥–Ω—ã–µ face+card —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

üîÅ 2. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π

ISUP –∏ ISAPI —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É:

{
  "timestamp": "2025-01-21T10:23:41",
  "device_id": "343831383733390D",
  "event_type": "ACCESS",
  "direction": "IN",
  "card_number": "1234567890",
  "employee_number": "10078",
  "success": true
}

üì® 3. –ü–µ—Ä–µ–¥–∞—á–∞ –≤ 1–° (HTTP Integration)
	‚Ä¢	HTTPS / HTTP
	‚Ä¢	Basic Auth
	‚Ä¢	retry –ª–æ–≥–∏–∫–∞ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏)
	‚Ä¢	configurable endpoint
	‚Ä¢	tenant-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
	‚Ä¢	–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ / —Ñ–∏–ª–∏–∞–ª–æ–≤

üì¶ 4. –•—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
	‚Ä¢	–ö–∞–∂–¥—ã–π event —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ storage/
	‚Ä¢	JSON —Ñ–æ—Ä–º–∞—Ç
	‚Ä¢	–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π
	‚Ä¢	–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∞–≤—Ç–æ-—Ä–µ—Ç—Ä–∞–π

üìä 5. HTTP API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

/health
/metrics
/tenants

üõ° 6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP (–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫)

ISUP/ISAPI –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö IP.

‚∏ª

üß± –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
	‚Ä¢	Python 3.10+
	‚Ä¢	aiohttp
	‚Ä¢	pyyaml

Install:

pip install -r requirements.txt


‚∏ª

üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

python3 main.py

Bridge –∑–∞–ø—É—Å–∫–∞–µ—Ç:

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞	–ü–æ—Ä—Ç	–û–ø–∏—Å–∞–Ω–∏–µ
ISUP TCP —Å–µ—Ä–≤–µ—Ä	:8001	–ü—Ä–∏–µ–º –±–∏–Ω–∞—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
ISAPI Webhook	:8002	XML + —Ñ–æ—Ç–æ —Å–æ–±—ã—Ç–∏—è
HTTP API	:8081	/health /metrics


‚∏ª

üì° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ Hikvision

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

Configuration ‚Üí Event ‚Üí Upload Events via HTTP ‚Üí Enable

URL:

http://YOUR_SERVER_IP:8002/ISAPI/Event/notification/alert

–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:
	‚Ä¢	AccessControlEvent
	‚Ä¢	FaceMatchEvent
	‚Ä¢	CardEvent

‚∏ª

üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ISUP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

–í Web UI:

Network ‚Üí Advanced ‚Üí ISUP

–£–∫–∞–∑–∞—Ç—å:
	‚Ä¢	–ø—Ä–æ—Ç–æ–∫–æ–ª v5
	‚Ä¢	–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ ‚Üí –≤–∞—à —Å–µ—Ä–≤–µ—Ä :8001
	‚Ä¢	heartbeat –≤–∫–ª—é—á–µ–Ω
	‚Ä¢	ACK —Ä–µ–∂–∏–º ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

‚∏ª

üóÇ –§–æ—Ä–º–∞—Ç config.yaml

–û–±—ä–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç:
	‚Ä¢	1–° —Å–µ—Ä–≤–µ—Ä
	‚Ä¢	ISUP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
	‚Ä¢	ISAPI —Ç–µ—Ä–º–∏–Ω–∞–ª—ã
	‚Ä¢	–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (entry/exit)

–ü—Ä–∏–º–µ—Ä:

objects:
  - object_id: "moscow_hq"
    name: "–ì–ª–∞–≤–Ω—ã–π –æ—Ñ–∏—Å –ú–æ—Å–∫–≤–∞"
    c1:
      base_url: "https://1c.company.ru"
      endpoint: "/hs/access/events"
      username: "bridge"
      password: "pass"
    terminals:
      - terminal_id: "hq_main_entrance"
        ip_address: "192.168.10.10"
        direction: "in"


‚∏ª

üìà –ú–µ—Ç—Ä–∏–∫–∏ (/metrics)

{
  "uptime_seconds": 3600,
  "events": {
    "received": 2048,
    "ok": 2033,
    "failed": 15,
    "pending": 6,
    "success_rate": 99.2
  }
}


‚∏ª

üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:

ISUP (—á–µ—Ä–µ–∑ TCP):

nc YOUR_SERVER 8001 < sample_isup_packet.bin

ISAPI:

curl -X POST -d "@event.xml" http://YOUR_SERVER:8002/ISAPI/Event/notification/alert

‚∏ª

üõ† –ï–¥–∏–Ω–∞—è –≤–µ—Ç–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞

- üìå –ï–¥–∏–Ω–∞—è —Ä–∞–±–æ—á–∞—è –≤–µ—Ç–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤–µ—Ç–∫—É `codex` (–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—à–∏—Ç–µ `main`/`master` fast-forward –Ω–∞ –Ω–µ—ë, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å). –ß—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏ –∫ —ç—Ç–∞–ª–æ–Ω—É:
  ```bash
  git checkout codex
  git branch -f main
  git branch -f master
  git checkout main
  ```
  –í production —Ä–∞–±–æ—Ç–∞–π—Ç–µ –∏–∑ `main`, –Ω–æ –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–∏—Ç-–≤-–±–∏—Ç —Ä–∞–≤–µ–Ω `codex`.

1) –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `/opt/isup_bridge` (–≤–µ—Ç–∫–∏ `main`, `master` –∏ `codex` –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –≤—ã—à–µ).
2) –û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   cd /opt/isup_bridge
   python3 -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```
3) –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ unit-—Ñ–∞–π–ª systemd —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –µ–¥–∏–Ω—ã–π –≤—Ö–æ–¥ `main.py`:
   ```ini
   [Service]
   WorkingDirectory=/opt/isup_bridge
   ExecStart=/opt/isup_bridge/.venv/bin/python /opt/isup_bridge/main.py
   ```
4) –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª—É–∂–±—É:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl restart isup-bridge.service
   sudo systemctl status isup-bridge.service
   ```
5) –ü—Ä–æ–≤–µ—Ä–∫–∞:
   - `/health` –Ω–∞ –ø–æ—Ä—Ç—É health_check –∏–∑ `config.yaml`.
   - –õ–æ–≥–∏ –≤ `/opt/isup_bridge/logs/` (—Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
   - `journalctl -u isup-bridge.service -f` –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –æ –∑–∞–ø—É—Å–∫–µ ISUP TCP –∏ ISAPI Webhook —Å–µ—Ä–≤–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–æ–±—â–µ–Ω–∏—è
     `ISUP TCP server listening` –∏ `ISAPI Webhook server started`).


‚∏ª

üõ† –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

–ü—Ä–æ–µ–∫—Ç –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è:
	‚Ä¢	–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Kafka
	‚Ä¢	—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ PostgreSQL
	‚Ä¢	–ø–æ–¥–¥–µ—Ä–∂–∫–∞ ZKTeco
	‚Ä¢	–ø–æ–¥–¥–µ—Ä–∂–∫–∞ Dahua
	‚Ä¢	–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ S3

‚∏ª

üë®‚Äçüíª –ê–≤—Ç–æ—Ä eldar40 / –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é —á–∞—Å—Ç–Ω–æ–π –æ—Ö—Ä–∞–Ω–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ ‚Äú–°–û–í–ê‚Äù
–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∏–ª–∏–∞–ª–∞–º–∏.
